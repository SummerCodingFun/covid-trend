{"ast":null,"code":"import _regeneratorRuntime from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{toast}from'react-toastify';import{Popup}from'../popup/popup.comp';import{FormRow}from'../formRow/formRow.comp';import{Button}from'../button/button.comp';import{Loader}from'../loader/loader.comp';import{dataHelpers}from'../../helpers/data.helpers';import{fileHelpers}from'../../helpers/file.helpers';import{withAppContext}from'../withContext/withContext.comp';import'./formPopup.scss';var unflatten=require('flat').unflatten;export var FormPopup=withAppContext(function(_ref){var context=_ref.context,title=_ref.title,fields=_ref.fields,rawData=_ref.rawData,getSingleConfig=_ref.getSingleConfig,methodConfig=_ref.methodConfig,submitCallback=_ref.submitCallback,_closeCallback=_ref.closeCallback;var fieldsCopy=JSON.parse(JSON.stringify(fields));var httpService=context.httpService,activePage=context.activePage,config=context.config;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),formFields=_useState4[0],setFormFields=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),finalRawData=_useState6[0],setFinalRawData=_useState6[1];var pageHeaders=(activePage===null||activePage===void 0?void 0:activePage.requestHeaders)||{};var customLabels=_objectSpread({},config===null||config===void 0?void 0:config.customLabels,{},activePage===null||activePage===void 0?void 0:activePage.customLabels);function initFormFields(){var finalRawData,url,requestHeaders,actualMethod,dataPath,queryParams,result,extractedData;return _regeneratorRuntime.async(function initFormFields$(_context){while(1){switch(_context.prev=_context.next){case 0:finalRawData=rawData||{};if(!(getSingleConfig&&getSingleConfig.url)){_context.next=15;break;}_context.prev=2;url=getSingleConfig.url,requestHeaders=getSingleConfig.requestHeaders,actualMethod=getSingleConfig.actualMethod,dataPath=getSingleConfig.dataPath,queryParams=getSingleConfig.queryParams;_context.next=6;return _regeneratorRuntime.awrap(httpService.fetch({method:actualMethod||'get',origUrl:url,queryParams:queryParams,headers:Object.assign({},pageHeaders,requestHeaders||{}),rawData:rawData}));case 6:result=_context.sent;extractedData=dataHelpers.extractDataByDataPath(result,dataPath);if(extractedData&&typeof extractedData==='object'){finalRawData=extractedData;}_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](2);console.error('Could not load single item\\'s data.',_context.t0);toast.error('Could not load single item\\'s data.');case 15:setFinalRawData(finalRawData);// Store the raw data for later.\nsetFormFields(fieldsCopy.map(function(field){var key=field.name;field.originalName=field.name;var dataPathSplit=[];if(field.dataPath){dataPathSplit=field.dataPath.split('.');key=\"\".concat(field.dataPath,\".\").concat(field.name);}var lookup=function lookup(){var objToLookIn=finalRawData;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=dataPathSplit[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var pathElem=_step.value;if(objToLookIn[pathElem]!==undefined&&objToLookIn[pathElem]!==null){objToLookIn=objToLookIn[pathElem];}else{return undefined;}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}return objToLookIn[field.name];};var lookupValue=lookup();// Changing field name to include datapath\n// This will use us later for unflatten the final object\nfield.name=key;if(dataHelpers.checkIfFieldIsObject(field)){if(lookupValue||field.value){field.value=JSON.stringify(lookupValue||field.value,null,'  ')||'';}return field;}if(field.type==='array'){field.value=lookupValue||field.value||[];return field;}if(typeof lookupValue!=='undefined'){field.value=lookupValue;}else{// important in order to prevent controlled / uncontrolled components error\nfield.value=typeof field.value==='undefined'?'':field.value;}return field;}));setLoading(false);case 18:case\"end\":return _context.stop();}}},null,null,[[2,11]]);}function submitForm(e){var finalObject,formData,containFiles,validationError,_body;return _regeneratorRuntime.async(function submitForm$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();finalObject=methodConfig.includeOriginalFields?Object.assign({},finalRawData):{};formData=new FormData();containFiles=fileHelpers.isMultipartForm(formFields);validationError=null;formFields.forEach(function(field){if(field.type==='file'){var fileInput=document.querySelector(\"input[name=\\\"\".concat(field.name||'file',\"\\\"]\"));if(fileInput.files.length>0){var firstFile=fileInput.files[0];formData.append(field.name||'file',firstFile,firstFile.name);}return;}finalObject[field.name]=field.value;if(containFiles){formData.append(field.name,field.value);}if(field.required&&field.type!=='boolean'&&!field.value){validationError='Please fill up all required fields.';}if(dataHelpers.checkIfFieldIsObject(field)&&field.value){try{finalObject[field.name]=JSON.parse(field.value);}catch(e){validationError=\"Invalid JSON for field \\\"\".concat(field.name,\"\\\".\");}}if(field.type==='boolean'){finalObject[field.name]=field.value||false;}if(field.type==='encode'){finalObject[field.name]=encodeURIComponent(field.value);}});if(!validationError){_context2.next=9;break;}toast.error(validationError);return _context2.abrupt(\"return\");case 9:setLoading(true);_context2.prev=10;_body=containFiles?formData:unflatten(finalObject);_context2.next=14;return _regeneratorRuntime.awrap(submitCallback(_body,containFiles));case 14:toast.success('Great Success!');_closeCallback(true);_context2.next=21;break;case 18:_context2.prev=18;_context2.t0=_context2[\"catch\"](10);toast.error(_context2.t0.message);case 21:setLoading(false);case 22:case\"end\":return _context2.stop();}}},null,null,[[10,18]]);}function formChanged(fieldName,value){var updatedFormFields=JSON.parse(JSON.stringify(formFields));updatedFormFields=updatedFormFields.map(function(field){if(field.name===fieldName){field.value=value;}return field;});setFormFields(updatedFormFields);}useEffect(function(){initFormFields();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);return React.createElement(Popup,{show:true,className:\"form-popup\",closeCallback:function closeCallback(){return _closeCallback(false);},customLabels:customLabels},React.createElement(React.Fragment,null,React.createElement(\"h2\",null,title),React.createElement(\"section\",null,loading?React.createElement(Loader,null):React.createElement(\"form\",{onSubmit:submitForm},formFields.map(function(field,idx){return React.createElement(FormRow,{key:\"field_\".concat(idx),field:field,onChange:formChanged,showReset:!field.type||field.type==='text'});}),React.createElement(\"div\",{className:\"buttons-wrapper center\"},React.createElement(Button,{type:\"submit\",onClick:submitForm,color:\"green\"},\"Submit\"))))));});","map":{"version":3,"sources":["/Users/claire/Desktop/covid-trend/RESTool2/src/components/formPopup/formPopup.comp.tsx"],"names":["React","useState","useEffect","toast","Popup","FormRow","Button","Loader","dataHelpers","fileHelpers","withAppContext","unflatten","require","FormPopup","context","title","fields","rawData","getSingleConfig","methodConfig","submitCallback","closeCallback","fieldsCopy","JSON","parse","stringify","httpService","activePage","config","loading","setLoading","formFields","setFormFields","finalRawData","setFinalRawData","pageHeaders","requestHeaders","customLabels","initFormFields","url","actualMethod","dataPath","queryParams","fetch","method","origUrl","headers","Object","assign","result","extractedData","extractDataByDataPath","console","error","map","field","key","name","originalName","dataPathSplit","split","lookup","objToLookIn","pathElem","undefined","lookupValue","checkIfFieldIsObject","value","type","submitForm","e","preventDefault","finalObject","includeOriginalFields","formData","FormData","containFiles","isMultipartForm","validationError","forEach","fileInput","document","querySelector","files","length","firstFile","append","required","encodeURIComponent","body","success","message","formChanged","fieldName","updatedFormFields","idx"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { toast } from 'react-toastify';\n\nimport { Popup } from '../popup/popup.comp';\nimport {\n  IConfigInputField,\n  IConfigGetSingleMethod,\n  IConfigPostMethod,\n  IConfigPutMethod,\n  ICustomLabels\n} from '../../common/models/config.model';\nimport { FormRow } from '../formRow/formRow.comp';\nimport { Button } from '../button/button.comp';\nimport { Loader } from '../loader/loader.comp';\nimport { dataHelpers } from '../../helpers/data.helpers';\nimport { fileHelpers } from '../../helpers/file.helpers';\nimport { IAppContext } from '../app.context';\nimport { withAppContext } from '../withContext/withContext.comp';\n\nimport './formPopup.scss';\n\nconst unflatten = require('flat').unflatten;\n\ninterface IProps {\n  context: IAppContext\n  title: string\n  fields: IConfigInputField[]\n  rawData?: any\n  getSingleConfig?: IConfigGetSingleMethod\n  methodConfig: IConfigPostMethod | IConfigPutMethod\n  closeCallback: (reloadData: boolean) => void\n  submitCallback: (body: any, containFiles: boolean) => void\n}\n\nexport const FormPopup = withAppContext(({ context, title, fields, rawData, getSingleConfig, methodConfig, submitCallback, closeCallback }: IProps) => {\n  const fieldsCopy: IConfigInputField[] = JSON.parse(JSON.stringify(fields));\n  const { httpService, activePage, config } = context;\n  const [loading, setLoading] = useState<boolean>(true);\n  const [formFields, setFormFields] = useState<IConfigInputField[]>([]);\n  const [finalRawData, setFinalRawData] = useState<any>(null);\n  const pageHeaders: any = activePage?.requestHeaders || {};\n  const customLabels: ICustomLabels | undefined = { ...config?.customLabels, ...activePage?.customLabels };\n\n  async function initFormFields() {\n    let finalRawData: any = rawData || {};\n\n    if (getSingleConfig && getSingleConfig.url) {\n      try {\n        const { url, requestHeaders, actualMethod, dataPath, queryParams } = getSingleConfig;\n        const result = await httpService.fetch({\n          method: actualMethod || 'get',\n          origUrl: url,\n          queryParams,\n          headers: Object.assign({}, pageHeaders,  requestHeaders || {}),\n          rawData,\n        });\n\n        const extractedData = dataHelpers.extractDataByDataPath(result, dataPath);\n\n        if (extractedData && typeof extractedData === 'object') {\n          finalRawData = extractedData;\n        }\n      } catch (e) {\n        console.error('Could not load single item\\'s data.', e);\n        toast.error('Could not load single item\\'s data.');\n      }\n    }\n\n    setFinalRawData(finalRawData); // Store the raw data for later.\n\n    setFormFields(fieldsCopy.map((field) => {\n      let key = field.name;\n\n      field.originalName = field.name;\n\n      let dataPathSplit: string[] = [];\n\n      if (field.dataPath) {\n        dataPathSplit = field.dataPath.split('.');\n        key = `${field.dataPath}.${field.name}`;\n      }\n\n      const lookup = () => {\n        let objToLookIn = finalRawData;\n        for(const pathElem of dataPathSplit) {\n          if(objToLookIn[pathElem] !== undefined && objToLookIn[pathElem] !== null) {\n            objToLookIn = objToLookIn[pathElem];\n          } else {\n            return undefined;\n          }\n        }\n        return objToLookIn[field.name];\n      }\n\n      const lookupValue = lookup();\n\n      // Changing field name to include datapath\n      // This will use us later for unflatten the final object\n      field.name = key;\n\n      if (dataHelpers.checkIfFieldIsObject(field)) {\n        if (lookupValue || field.value) {\n          field.value = JSON.stringify(lookupValue || field.value, null, '  ') || '';\n        }\n        return field;\n      }\n\n      if (field.type === 'array') {\n        field.value = lookupValue || field.value || [];\n        return field;\n      }\n\n      if (typeof lookupValue !== 'undefined') {\n        field.value = lookupValue;\n      } else {\n        // important in order to prevent controlled / uncontrolled components error\n        field.value = typeof field.value === 'undefined' ? '' : field.value;\n      }\n\n      return field;\n    }));\n\n    setLoading(false);\n  }\n\n  async function submitForm(e: any) {\n    e.preventDefault();\n\n    const finalObject: any = (methodConfig as IConfigPutMethod).includeOriginalFields ? Object.assign({}, finalRawData) : {};\n    const formData = new FormData();\n    const containFiles: boolean = fileHelpers.isMultipartForm(formFields);\n    let validationError = null;\n\n    formFields.forEach((field) => {\n      if (field.type === 'file') {\n        const fileInput: any = document.querySelector(`input[name=\"${field.name || 'file'}\"]`) as HTMLInputElement;\n\n        if (fileInput.files.length > 0) {\n          const firstFile = fileInput.files[0];\n          formData.append(field.name || 'file', firstFile, firstFile.name);\n        }\n        return;\n      }\n\n      finalObject[field.name] = field.value;\n\n      if (containFiles) {\n        formData.append(field.name, field.value);\n      }\n\n      if (field.required && field.type !== 'boolean' && !field.value) {\n        validationError = 'Please fill up all required fields.';\n      }\n\n      if (dataHelpers.checkIfFieldIsObject(field) && field.value) {\n        try {\n          finalObject[field.name] = JSON.parse(field.value);\n        } catch (e) {\n          validationError = `Invalid JSON for field \"${field.name}\".`;\n        }\n      }\n\n      if (field.type === 'boolean') {\n        finalObject[field.name] = field.value || false;\n      }\n\n      if (field.type === 'encode') {\n        finalObject[field.name] = encodeURIComponent(field.value);\n      }\n    });\n\n    if (validationError) {\n      toast.error(validationError);\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const body = containFiles ? formData : unflatten(finalObject);\n      await submitCallback(body, containFiles);\n\n      toast.success('Great Success!');\n\n      closeCallback(true);\n    } catch (e) {\n      toast.error(e.message);\n    }\n\n    setLoading(false);\n  }\n\n  function formChanged(fieldName: string, value: any) {\n    let updatedFormFields: IConfigInputField[] = JSON.parse(JSON.stringify(formFields));\n\n    updatedFormFields = updatedFormFields.map((field: IConfigInputField) => {\n      if (field.name === fieldName) {\n        field.value = value;\n      }\n\n      return field;\n    });\n\n    setFormFields(updatedFormFields);\n  }\n\n  useEffect(() => {\n    initFormFields();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <Popup\n      show={true}\n      className=\"form-popup\"\n      closeCallback={() => closeCallback(false)}\n      customLabels={customLabels}\n    >\n      <React.Fragment>\n        <h2>{title}</h2>\n        <section>\n          {\n            loading ?\n            <Loader /> :\n            <form onSubmit={submitForm}>\n              {\n                formFields.map((field, idx) => {\n                  return (\n                    <FormRow\n                      key={`field_${idx}`}\n                      field={field}\n                      onChange={formChanged}\n                      showReset={!field.type || field.type === 'text'}\n                    />\n                  );\n                })\n              }\n              <div className=\"buttons-wrapper center\">\n                <Button type=\"submit\" onClick={submitForm} color=\"green\">Submit</Button>\n              </div>\n            </form>\n          }\n        </section>\n      </React.Fragment>\n    </Popup>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}