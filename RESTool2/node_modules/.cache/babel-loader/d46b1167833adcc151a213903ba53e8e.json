{"ast":null,"code":"import _regeneratorRuntime from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _classCallCheck from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/claire/RESTool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import HTTPService from'./http.service';import Ajv from'ajv';var httpService=new HTTPService();var ConfigService=/*#__PURE__*/function(_HTTPService){_inherits(ConfigService,_HTTPService);function ConfigService(){_classCallCheck(this,ConfigService);return _possibleConstructorReturn(this,_getPrototypeOf(ConfigService).apply(this,arguments));}_createClass(ConfigService,[{key:\"getRemoteConfig\",value:function getRemoteConfig(url){return _regeneratorRuntime.async(function getRemoteConfig$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!url.endsWith('.js')){_context.next=4;break;}_context.next=3;return _regeneratorRuntime.awrap(import(/* webpackIgnore: true */url));case 3:return _context.abrupt(\"return\",_context.sent.default);case 4:_context.next=6;return _regeneratorRuntime.awrap(httpService.fetch({origUrl:url}));case 6:return _context.abrupt(\"return\",_context.sent);case 7:case\"end\":return _context.stop();}}});}},{key:\"loadDefaultConfig\",value:function loadDefaultConfig(){return _regeneratorRuntime.async(function loadDefaultConfig$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regeneratorRuntime.awrap(this.getRemoteConfig('/config.json'));case 3:return _context2.abrupt(\"return\",_context2.sent);case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);_context2.next=10;return _regeneratorRuntime.awrap(this.getRemoteConfig('/config.js'));case 10:return _context2.abrupt(\"return\",_context2.sent);case 11:case\"end\":return _context2.stop();}}},null,this,[[0,6]]);}},{key:\"validateConfig\",value:function validateConfig(config){if(config===null){return{isValid:true,errorMessage:null};}var configSchema=require('../assets/schemas/config.schema.json');var ajv=new Ajv({allErrors:true,verbose:true});var validate=ajv.compile(configSchema);var isValid=validate(config);if(typeof isValid!=='boolean'){throw new Error('Unexpected asynchronous JSON validation');}if(isValid){return{isValid:isValid,errorMessage:null};}var firstError=validate.errors?validate.errors[0]:undefined;var errorMessage=null;if((firstError===null||firstError===void 0?void 0:firstError.message)&&(firstError===null||firstError===void 0?void 0:firstError.dataPath)){errorMessage=\"Error parsing configuration at \\\"\".concat(firstError.dataPath,\"\\\": \").concat(firstError.message);}else if(firstError===null||firstError===void 0?void 0:firstError.message){errorMessage=\"Error parsing configuration: \".concat(firstError.message);}else if(firstError===null||firstError===void 0?void 0:firstError.dataPath){errorMessage=\"Error parsing configuration at \\\"\".concat(firstError.dataPath,\"\\\"\");}else{errorMessage=\"Error parsing configuration\";}console.error(errorMessage);console.error('All configuration errors: ',validate.errors);return{isValid:isValid,errorMessage:errorMessage};}}]);return ConfigService;}(HTTPService);export default new ConfigService();","map":{"version":3,"sources":["/Users/claire/RESTool/src/services/config.service.ts"],"names":["HTTPService","Ajv","httpService","ConfigService","url","endsWith","default","fetch","origUrl","getRemoteConfig","config","isValid","errorMessage","configSchema","require","ajv","allErrors","verbose","validate","compile","Error","firstError","errors","undefined","message","dataPath","console","error"],"mappings":"60BAAA,MAAOA,CAAAA,WAAP,KAAwB,gBAAxB,CAEA,MAAOC,CAAAA,GAAP,KAAgB,KAAhB,CAEA,GAAMC,CAAAA,WAAwB,CAAG,GAAIF,CAAAA,WAAJ,EAAjC,C,GAEMG,CAAAA,a,wTAEyBC,G,+HACvBA,GAAG,CAACC,QAAJ,CAAa,KAAb,C,0EACY,OAAO,yBAAyBD,GAAhC,C,uDAAsCE,O,0DAEzCJ,WAAW,CAACK,KAAZ,CAAkB,CAC7BC,OAAO,CAAEJ,GADoB,CAAlB,C,qWAOE,KAAKK,eAAL,CAAqB,cAArB,C,wKAEC,KAAKA,eAAL,CAAqB,YAArB,C,mLAIIC,M,CAA2E,CAC/F,GAAIA,MAAM,GAAK,IAAf,CAAqB,CACnB,MAAO,CACLC,OAAO,CAAE,IADJ,CAELC,YAAY,CAAE,IAFT,CAAP,CAID,CACD,GAAMC,CAAAA,YAAY,CAAGC,OAAO,CAAC,sCAAD,CAA5B,CACA,GAAMC,CAAAA,GAAG,CAAG,GAAId,CAAAA,GAAJ,CAAQ,CAClBe,SAAS,CAAE,IADO,CAElBC,OAAO,CAAE,IAFS,CAAR,CAAZ,CAIA,GAAMC,CAAAA,QAAQ,CAAGH,GAAG,CAACI,OAAJ,CAAYN,YAAZ,CAAjB,CACA,GAAMF,CAAAA,OAAO,CAAGO,QAAQ,CAACR,MAAD,CAAxB,CACA,GAAI,MAAOC,CAAAA,OAAP,GAAmB,SAAvB,CAAkC,CAChC,KAAM,IAAIS,CAAAA,KAAJ,CAAU,yCAAV,CAAN,CACD,CACD,GAAIT,OAAJ,CAAa,CACX,MAAO,CACLA,OAAO,CAAPA,OADK,CAELC,YAAY,CAAE,IAFT,CAAP,CAID,CACD,GAAMS,CAAAA,UAAU,CAAGH,QAAQ,CAACI,MAAT,CAAkBJ,QAAQ,CAACI,MAAT,CAAgB,CAAhB,CAAlB,CAAuCC,SAA1D,CACA,GAAIX,CAAAA,YAA2B,CAAG,IAAlC,CACA,GAAI,CAAAS,UAAU,OAAV,EAAAA,UAAU,SAAV,QAAAA,UAAU,CAAEG,OAAZ,IAAuBH,UAAvB,SAAuBA,UAAvB,iBAAuBA,UAAU,CAAEI,QAAnC,CAAJ,CAAiD,CAC/Cb,YAAY,4CAAsCS,UAAU,CAACI,QAAjD,gBAA+DJ,UAAU,CAACG,OAA1E,CAAZ,CACD,CAFD,IAEO,IAAIH,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEG,OAAhB,CAAyB,CAC9BZ,YAAY,wCAAmCS,UAAU,CAACG,OAA9C,CAAZ,CACD,CAFM,IAEA,IAAIH,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEI,QAAhB,CAA0B,CAC/Bb,YAAY,4CAAsCS,UAAU,CAACI,QAAjD,MAAZ,CACD,CAFM,IAEA,CACLb,YAAY,8BAAZ,CACD,CACDc,OAAO,CAACC,KAAR,CAAcf,YAAd,EACAc,OAAO,CAACC,KAAR,CAAc,4BAAd,CAA4CT,QAAQ,CAACI,MAArD,EACA,MAAO,CACLX,OAAO,CAAPA,OADK,CAELC,YAAY,CAAZA,YAFK,CAAP,CAID,C,2BA3DyBZ,W,EA+D5B,cAAe,IAAIG,CAAAA,aAAJ,EAAf","sourcesContent":["import HTTPService from './http.service';\nimport { IConfig } from '../common/models/config.model';\nimport Ajv from 'ajv';\n\nconst httpService: HTTPService = new HTTPService();\n\nclass ConfigService extends HTTPService {\n\n  public async getRemoteConfig(url: string) {\n    if (url.endsWith('.js')) {\n      return (await import(/* webpackIgnore: true */url)).default;\n    }\n    return await httpService.fetch({\n      origUrl: url,\n    });\n  }\n\n  public async loadDefaultConfig() {\n    try {\n      return await this.getRemoteConfig('/config.json');\n    } catch (e) {\n      return (await this.getRemoteConfig('/config.js'));\n    }\n  }\n\n  public validateConfig(config: IConfig | null): { isValid: boolean, errorMessage: string | null } {\n    if (config === null) {\n      return {\n        isValid: true,\n        errorMessage: null,\n      }\n    }\n    const configSchema = require('../assets/schemas/config.schema.json');\n    const ajv = new Ajv({\n      allErrors: true,\n      verbose: true,\n    });\n    const validate = ajv.compile(configSchema);\n    const isValid = validate(config);\n    if (typeof isValid !== 'boolean') {\n      throw new Error('Unexpected asynchronous JSON validation');\n    }\n    if (isValid) {\n      return {\n        isValid,\n        errorMessage: null,\n      }\n    }\n    const firstError = validate.errors ? validate.errors[0] : undefined;\n    let errorMessage: string | null = null;\n    if (firstError?.message && firstError?.dataPath) {\n      errorMessage = `Error parsing configuration at \"${firstError.dataPath}\": ${firstError.message}`\n    } else if (firstError?.message) {\n      errorMessage = `Error parsing configuration: ${firstError.message}`\n    } else if (firstError?.dataPath) {\n      errorMessage = `Error parsing configuration at \"${firstError.dataPath}\"`\n    } else {\n      errorMessage = `Error parsing configuration`;\n    }\n    console.error(errorMessage);\n    console.error('All configuration errors: ', validate.errors);\n    return {\n      isValid,\n      errorMessage,\n    };\n  }\n\n}\n\nexport default new ConfigService();\n"]},"metadata":{},"sourceType":"module"}