{"ast":null,"code":"import _regeneratorRuntime from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useEffect,useState}from'react';import{useParams,useHistory}from'react-router-dom';import*as QueryString from'query-string';import{toast}from'react-toastify';import{orderBy}from'natural-orderby';import{find,remove}from'lodash';import{withAppContext}from'../withContext/withContext.comp';import{Loader}from'../loader/loader.comp';import{dataHelpers}from'../../helpers/data.helpers';import{paginationHelpers}from'../../helpers/pagination.helpers';import{Table}from'../table/table.comp';import{Cards}from'../cards/cards.comp';import{QueryParams}from'../queryParams/queryParams.comp';import{Button}from'../button/button.comp';import{FormPopup}from'../formPopup/formPopup.comp';import{FilterField}from'../filterField/filterField.comp';import{isQueryPaginationState,isBodyPaginationState}from'../../common/models/states.types.helper';import{isQueryPagination,isBodyPagination}from'../../common/models/config.types.helper';import'./page.scss';var buildInitQueryParamsAndPaginationState=function buildInitQueryParamsAndPaginationState(initQueryParams,paginationConfig){var initialPagination=undefined;if(paginationConfig){if(isQueryPagination(paginationConfig)){var _paginationConfig$par,_paginationConfig$par2,_paginationConfig$par3,_paginationConfig$par4,_paginationConfig$par5,_paginationConfig$par6,_paginationConfig$par7,_paginationConfig$par8,_paginationConfig$par13,_paginationConfig$par14,_paginationConfig$par15;initialPagination={source:paginationConfig.source,type:paginationConfig.type,page:parseInt(((_paginationConfig$par=paginationConfig.params)===null||_paginationConfig$par===void 0?void 0:(_paginationConfig$par2=_paginationConfig$par.page)===null||_paginationConfig$par2===void 0?void 0:_paginationConfig$par2.value)||'1'),limit:parseInt(((_paginationConfig$par3=paginationConfig.params)===null||_paginationConfig$par3===void 0?void 0:(_paginationConfig$par4=_paginationConfig$par3.limit)===null||_paginationConfig$par4===void 0?void 0:_paginationConfig$par4.value)||'10'),descending:((_paginationConfig$par5=paginationConfig.params)===null||_paginationConfig$par5===void 0?void 0:(_paginationConfig$par6=_paginationConfig$par5.descending)===null||_paginationConfig$par6===void 0?void 0:_paginationConfig$par6.value)==='true'||false,hasPreviousPage:false,hasNextPage:false,sortBy:(_paginationConfig$par7=paginationConfig.params)===null||_paginationConfig$par7===void 0?void 0:(_paginationConfig$par8=_paginationConfig$par7.sortBy)===null||_paginationConfig$par8===void 0?void 0:_paginationConfig$par8.value};if(!find(initQueryParams,{name:'page'})){var _paginationConfig$par9,_paginationConfig$par10,_paginationConfig$par11,_paginationConfig$par12,_initialPagination;initQueryParams.push({name:paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par9=paginationConfig.params)===null||_paginationConfig$par9===void 0?void 0:(_paginationConfig$par10=_paginationConfig$par9.page)===null||_paginationConfig$par10===void 0?void 0:_paginationConfig$par10.name,label:(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par11=paginationConfig.params)===null||_paginationConfig$par11===void 0?void 0:(_paginationConfig$par12=_paginationConfig$par11.page)===null||_paginationConfig$par12===void 0?void 0:_paginationConfig$par12.label)||'Page',value:(_initialPagination=initialPagination)===null||_initialPagination===void 0?void 0:_initialPagination.page});}if((paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par13=paginationConfig.params)===null||_paginationConfig$par13===void 0?void 0:_paginationConfig$par13.limit)&&!find(initQueryParams,{name:'limit'})){var _initialPagination2;initQueryParams.push({name:paginationConfig.params.limit.name,label:paginationConfig.params.limit.label||'Limit',value:(_initialPagination2=initialPagination)===null||_initialPagination2===void 0?void 0:_initialPagination2.limit});}if((paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par14=paginationConfig.params)===null||_paginationConfig$par14===void 0?void 0:_paginationConfig$par14.descending)&&!find(initQueryParams,{name:'descending'})){var _initialPagination3;initQueryParams.push({name:paginationConfig.params.descending.name,label:paginationConfig.params.descending.label||'Descending',value:(_initialPagination3=initialPagination)===null||_initialPagination3===void 0?void 0:_initialPagination3.descending});}if((paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par15=paginationConfig.params)===null||_paginationConfig$par15===void 0?void 0:_paginationConfig$par15.sortBy)&&!find(initQueryParams,{name:'sortBy'})){var _initialPagination4;initQueryParams.push({name:paginationConfig.params.sortBy.name,label:'Sort by',value:(_initialPagination4=initialPagination)===null||_initialPagination4===void 0?void 0:_initialPagination4.sortBy});}}else if(isBodyPagination(paginationConfig)){var _paginationConfig$par16,_paginationConfig$par17,_paginationConfig$par18;initialPagination={source:'body',type:paginationConfig.type,hasNextPage:false,hasPreviousPage:false,next:null,previous:null,limit:parseInt(((_paginationConfig$par16=paginationConfig.params)===null||_paginationConfig$par16===void 0?void 0:(_paginationConfig$par17=_paginationConfig$par16.limit)===null||_paginationConfig$par17===void 0?void 0:_paginationConfig$par17.value)||'10')};if((paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par18=paginationConfig.params)===null||_paginationConfig$par18===void 0?void 0:_paginationConfig$par18.limit)&&!find(initQueryParams,{name:'limit'})){var _initialPagination5;initQueryParams.push({name:paginationConfig.params.limit.name,label:paginationConfig.params.limit.label||'Limit',value:(_initialPagination5=initialPagination)===null||_initialPagination5===void 0?void 0:_initialPagination5.limit});}}else{throw new Error('unrecognized pagination');}}return{initQueryParams:initQueryParams,initialPagination:initialPagination};};var PageComp=function PageComp(_ref){var _customLabels$buttons,_customLabels$formTit,_customLabels$formTit2,_openedPopup$config;var context=_ref.context;var _useParams=useParams(),page=_useParams.page;var _useHistory=useHistory(),push=_useHistory.push,location=_useHistory.location;var activePage=context.activePage,error=context.error,setError=context.setError,httpService=context.httpService,config=context.config;var pageHeaders=(activePage===null||activePage===void 0?void 0:activePage.requestHeaders)||{};var pageMethods=activePage===null||activePage===void 0?void 0:activePage.methods;var customActions=(activePage===null||activePage===void 0?void 0:activePage.customActions)||[];var getAllConfig=pageMethods===null||pageMethods===void 0?void 0:pageMethods.getAll;var paginationConfig=getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.pagination;var infiniteScroll=(paginationConfig===null||paginationConfig===void 0?void 0:paginationConfig.type)==='infinite-scroll';var getSingleConfig=pageMethods===null||pageMethods===void 0?void 0:pageMethods.getSingle;var postConfig=pageMethods===null||pageMethods===void 0?void 0:pageMethods.post;var putConfig=pageMethods===null||pageMethods===void 0?void 0:pageMethods.put;var deleteConfig=pageMethods===null||pageMethods===void 0?void 0:pageMethods.delete;var customLabels=_objectSpread({},config===null||config===void 0?void 0:config.customLabels,{},activePage===null||activePage===void 0?void 0:activePage.customLabels);var addItemLabel=(customLabels===null||customLabels===void 0?void 0:(_customLabels$buttons=customLabels.buttons)===null||_customLabels$buttons===void 0?void 0:_customLabels$buttons.addItem)||'+ Add Item';var addItemFormTitle=(customLabels===null||customLabels===void 0?void 0:(_customLabels$formTit=customLabels.formTitles)===null||_customLabels$formTit===void 0?void 0:_customLabels$formTit.addItem)||'Add Item';var editItemFormTitle=(customLabels===null||customLabels===void 0?void 0:(_customLabels$formTit2=customLabels.formTitles)===null||_customLabels$formTit2===void 0?void 0:_customLabels$formTit2.editItem)||'Update Item';var _buildInitQueryParams=buildInitQueryParamsAndPaginationState((getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.queryParams)||[],paginationConfig),initQueryParams=_buildInitQueryParams.initQueryParams,initialPagination=_buildInitQueryParams.initialPagination;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),openedPopup=_useState4[0],setOpenedPopup=_useState4[1];var _useState5=useState(initQueryParams),_useState6=_slicedToArray(_useState5,2),queryParams=_useState6[0],setQueryParams=_useState6[1];var _useState7=useState(initialPagination),_useState8=_slicedToArray(_useState7,2),pagination=_useState8[0],setPagination=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),items=_useState10[0],setItems=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),filter=_useState12[0],setFilter=_useState12[1];function closeFormPopup(){var refreshData=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;setOpenedPopup(null);if(refreshData===true){if((pagination===null||pagination===void 0?void 0:pagination.type)==='infinite-scroll'){setItems([]);var updatedParams=_toConsumableArray(queryParams);remove(updatedParams,function(param){return['page','limit'].includes(param.name);});setQueryParams(buildInitQueryParamsAndPaginationState(updatedParams,paginationConfig).initQueryParams);}else{getAllRequest();}}}function openEditPopup(rawData){var params;return _regeneratorRuntime.async(function openEditPopup$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params={rawData:rawData,type:'update',title:editItemFormTitle,config:putConfig,getSingleConfig:getSingleConfig,submitCallback:function submitCallback(body,containFiles){return _regeneratorRuntime.async(function submitCallback$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(updateItem(body,rawData,containFiles));case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}});}};setOpenedPopup(params);case 2:case\"end\":return _context2.stop();}}});}function openCustomActionPopup(rawData,action){var params={rawData:rawData,type:'action',title:action.name||'Custom Action',config:action,submitCallback:function submitCallback(body,containFiles){return _regeneratorRuntime.async(function submitCallback$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(performAction(body,rawData,action,containFiles));case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}});}};setOpenedPopup(params);}function performAction(body,rawData,action,containFiles){var url,requestHeaders,actualMethod;return _regeneratorRuntime.async(function performAction$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:url=action.url,requestHeaders=action.requestHeaders,actualMethod=action.actualMethod;_context4.next=3;return _regeneratorRuntime.awrap(httpService.fetch({method:actualMethod||'put',origUrl:url,rawData:rawData,body:containFiles?body:JSON.stringify(body),headers:_objectSpread({},pageHeaders,{},requestHeaders||{},{},containFiles?{}:{'content-type':'application/json'}),responseType:'boolean'}));case 3:return _context4.abrupt(\"return\",_context4.sent);case 4:case\"end\":return _context4.stop();}}});}function extractQueryParams(params){if(!paginationConfig||isQueryPagination(paginationConfig)){var parsedParams=QueryString.parse(location.search);var finalQueryParams=params.map(function(queryParam){if(typeof parsedParams[queryParam.name]!=='undefined'){queryParam.value=queryParam.type==='boolean'?parsedParams[queryParam.name]==='true':decodeURIComponent(parsedParams[queryParam.name]);}else{queryParam.value=queryParam.value||'';}return queryParam;});setPagination(getUpdatedPaginationState(finalQueryParams,null));return finalQueryParams;}else{return params;}}function fetchPageData(params){var result,extractedData,orderedItems,_paginationConfig$fie,total,newPaginationState;return _regeneratorRuntime.async(function fetchPageData$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(httpService.fetch({method:params.actualMethod||'get',origUrl:params.url,queryParams:queryParams,headers:Object.assign({},pageHeaders,params.requestHeaders||{})}));case 2:result=_context5.sent;extractedData=dataHelpers.extractDataByDataPath(result,params.dataPath);if(extractedData){_context5.next=6;break;}throw new Error('Could not extract data from response.');case 6:if(Array.isArray(extractedData)){_context5.next=8;break;}throw new Error('Extracted data is invalid.');case 8:if(!(typeof params.dataTransform==='function')){_context5.next=12;break;}_context5.next=11;return _regeneratorRuntime.awrap(params.dataTransform(extractedData));case 11:extractedData=_context5.sent;case 12:orderedItems=orderBy(extractedData,typeof params.sortBy==='string'?[params.sortBy]:params.sortBy||[]);if(paginationConfig){total=((_paginationConfig$fie=paginationConfig.fields)===null||_paginationConfig$fie===void 0?void 0:_paginationConfig$fie.total)?dataHelpers.extractDataByDataPath(result,paginationConfig.fields.total.dataPath):undefined;newPaginationState=getUpdatedPaginationState(queryParams,result,total);if(newPaginationState){setPagination(newPaginationState);}}if(infiniteScroll){setItems([].concat(_toConsumableArray(items),_toConsumableArray(orderedItems)));}else{setItems(orderedItems);}case 15:case\"end\":return _context5.stop();}}});}function getAllRequest(){var url,requestHeaders,actualMethod,dataPath,sortBy,dataTransform;return _regeneratorRuntime.async(function getAllRequest$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!infiniteScroll){_context6.next=13;break;}if(!pagination){_context6.next=11;break;}if(!isQueryPaginationState(pagination)){_context6.next=6;break;}if((pagination===null||pagination===void 0?void 0:pagination.page)!==1){setLoading(false);}_context6.next=11;break;case 6:if(!isBodyPaginationState(pagination)){_context6.next=10;break;}if(pagination.previous){setLoading(false);}_context6.next=11;break;case 10:throw new Error('unrecognized pagination source');case 11:_context6.next=14;break;case 13:setLoading(true);case 14:setError(null);_context6.prev=15;if(getAllConfig){_context6.next=18;break;}throw new Error('Get all method is not defined.');case 18:if(!(paginationConfig&&!pagination)){_context6.next=20;break;}throw new Error('Pagination not initialized.');case 20:url=getAllConfig.url,requestHeaders=getAllConfig.requestHeaders,actualMethod=getAllConfig.actualMethod,dataPath=getAllConfig.dataPath,sortBy=getAllConfig.sortBy,dataTransform=getAllConfig.dataTransform;fetchPageData({actualMethod:actualMethod,url:url,requestHeaders:requestHeaders,dataPath:dataPath,dataTransform:dataTransform,sortBy:sortBy});_context6.next=27;break;case 24:_context6.prev=24;_context6.t0=_context6[\"catch\"](15);setError(_context6.t0.message);case 27:setLoading(false);case 28:case\"end\":return _context6.stop();}}},null,null,[[15,24]]);}function addItem(body,containFiles){var url,requestHeaders,actualMethod;return _regeneratorRuntime.async(function addItem$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(postConfig){_context7.next=2;break;}throw new Error('Post method is not defined.');case 2:url=postConfig.url,requestHeaders=postConfig.requestHeaders,actualMethod=postConfig.actualMethod;_context7.next=5;return _regeneratorRuntime.awrap(httpService.fetch({method:actualMethod||'post',origUrl:url,body:containFiles?body:JSON.stringify(body),headers:_objectSpread({},pageHeaders,{},requestHeaders||{},{},containFiles?{}:{'content-type':'application/json'}),responseType:'boolean'}));case 5:return _context7.abrupt(\"return\",_context7.sent);case 6:case\"end\":return _context7.stop();}}});}function updateItem(body,rawData,containFiles){var url,requestHeaders,actualMethod;return _regeneratorRuntime.async(function updateItem$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(putConfig){_context8.next=2;break;}throw new Error('Put method is not defined.');case 2:url=putConfig.url,requestHeaders=putConfig.requestHeaders,actualMethod=putConfig.actualMethod;_context8.next=5;return _regeneratorRuntime.awrap(httpService.fetch({method:actualMethod||'put',origUrl:url,rawData:rawData,body:containFiles?body:JSON.stringify(body),headers:_objectSpread({},pageHeaders,{},requestHeaders||{},{},containFiles?{}:{'content-type':'application/json'}),responseType:'boolean'}));case 5:return _context8.abrupt(\"return\",_context8.sent);case 6:case\"end\":return _context8.stop();}}});}function deleteItem(item){var approved,url,requestHeaders,actualMethod,success,updatedParams;return _regeneratorRuntime.async(function deleteItem$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:approved=window.confirm('Are you sure you want to delete this item?');if(approved){_context9.next=3;break;}return _context9.abrupt(\"return\");case 3:_context9.prev=3;if(deleteConfig){_context9.next=6;break;}throw new Error('Delete method is not defined.');case 6:url=deleteConfig.url,requestHeaders=deleteConfig.requestHeaders,actualMethod=deleteConfig.actualMethod;_context9.next=9;return _regeneratorRuntime.awrap(httpService.fetch({method:actualMethod||'delete',origUrl:url,rawData:item,headers:Object.assign({},pageHeaders,requestHeaders||{}),responseType:'boolean'}));case 9:success=_context9.sent;if(success){if((pagination===null||pagination===void 0?void 0:pagination.type)==='infinite-scroll'){setItems([]);updatedParams=_toConsumableArray(queryParams);remove(updatedParams,function(param){return['page','limit'].includes(param.name);});setQueryParams(buildInitQueryParamsAndPaginationState(updatedParams,paginationConfig).initQueryParams);}else{getAllRequest();}}_context9.next=16;break;case 13:_context9.prev=13;_context9.t0=_context9[\"catch\"](3);toast.error(_context9.t0.message);case 16:case\"end\":return _context9.stop();}}},null,null,[[3,13]]);}function submitQueryParams(updatedParams,reset){if(loading){return;}if(reset){setItems([]);remove(updatedParams,function(param){return['page','limit'].includes(param.name);});updatedParams=buildInitQueryParamsAndPaginationState(updatedParams,paginationConfig).initQueryParams;}setQueryParams(updatedParams);setPagination(getUpdatedPaginationState(updatedParams,null));var paramsToUrl=_toConsumableArray(updatedParams);if((paginationConfig===null||paginationConfig===void 0?void 0:paginationConfig.type)==='infinite-scroll'){paramsToUrl=paramsToUrl.filter(function(param){return!['page','limit'].includes(param.name);});}// Building query string\nvar queryState=paramsToUrl.map(function(queryParam,idx){var value=queryParam.value;if(queryParam.type==='select'&&value==='-- Select --'){// default value means nothing was selected and thus we explicitly\n// empty out the value in this case; otherwise the string '-- Select --'\n// is used as the value for the given queryParams\nvalue='';}return\"\".concat(idx===0?'?':'').concat(queryParam.name,\"=\").concat(encodeURIComponent(value||''));}).join('&');// Pushing query state to url\nif(page&&queryState){push(queryState);}}function getUpdatedPaginationState(updatedParams,result,total){if(!paginationConfig){return;}if(isQueryPagination(paginationConfig)){var _paginationConfig$par19,_paginationConfig$par20,_paginationConfig$par21,_paginationConfig$par22,_paginationConfig$par23,_paginationConfig$par24,_paginationConfig$par25,_paginationConfig$par26,_updatedParams$find,_updatedParams$find2,_updatedParams$find3,_updatedParams$find4;if(pagination&&!isQueryPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}var newState=pagination?pagination:{source:'query',type:paginationConfig.type,page:parseInt(((_paginationConfig$par19=paginationConfig.params)===null||_paginationConfig$par19===void 0?void 0:(_paginationConfig$par20=_paginationConfig$par19.page)===null||_paginationConfig$par20===void 0?void 0:_paginationConfig$par20.value)||'1'),limit:parseInt(((_paginationConfig$par21=paginationConfig.params)===null||_paginationConfig$par21===void 0?void 0:(_paginationConfig$par22=_paginationConfig$par21.limit)===null||_paginationConfig$par22===void 0?void 0:_paginationConfig$par22.value)||'10'),descending:((_paginationConfig$par23=paginationConfig.params)===null||_paginationConfig$par23===void 0?void 0:(_paginationConfig$par24=_paginationConfig$par23.descending)===null||_paginationConfig$par24===void 0?void 0:_paginationConfig$par24.value)==='true'||false,hasPreviousPage:false,hasNextPage:false,sortBy:(_paginationConfig$par25=paginationConfig.params)===null||_paginationConfig$par25===void 0?void 0:(_paginationConfig$par26=_paginationConfig$par25.sortBy)===null||_paginationConfig$par26===void 0?void 0:_paginationConfig$par26.value};newState.total=total||(pagination===null||pagination===void 0?void 0:pagination.total);newState.page=parseInt((_updatedParams$find=updatedParams.find(function(param){var _paginationConfig$par27,_paginationConfig$par28;return param.name===(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par27=paginationConfig.params)===null||_paginationConfig$par27===void 0?void 0:(_paginationConfig$par28=_paginationConfig$par27.page)===null||_paginationConfig$par28===void 0?void 0:_paginationConfig$par28.name);}))===null||_updatedParams$find===void 0?void 0:_updatedParams$find.value)||newState.page;newState.limit=parseInt((_updatedParams$find2=updatedParams.find(function(param){var _paginationConfig$par29,_paginationConfig$par30;return param.name===(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par29=paginationConfig.params)===null||_paginationConfig$par29===void 0?void 0:(_paginationConfig$par30=_paginationConfig$par29.limit)===null||_paginationConfig$par30===void 0?void 0:_paginationConfig$par30.name);}))===null||_updatedParams$find2===void 0?void 0:_updatedParams$find2.value)||newState.limit;newState.descending=((_updatedParams$find3=updatedParams.find(function(param){var _paginationConfig$par31,_paginationConfig$par32;return param.name===(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par31=paginationConfig.params)===null||_paginationConfig$par31===void 0?void 0:(_paginationConfig$par32=_paginationConfig$par31.descending)===null||_paginationConfig$par32===void 0?void 0:_paginationConfig$par32.name);}))===null||_updatedParams$find3===void 0?void 0:_updatedParams$find3.value)==='true'||newState.descending;newState.sortBy=((_updatedParams$find4=updatedParams.find(function(param){var _paginationConfig$par33,_paginationConfig$par34;return param.name===(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par33=paginationConfig.params)===null||_paginationConfig$par33===void 0?void 0:(_paginationConfig$par34=_paginationConfig$par33.sortBy)===null||_paginationConfig$par34===void 0?void 0:_paginationConfig$par34.name);}))===null||_updatedParams$find4===void 0?void 0:_updatedParams$find4.value)||newState.sortBy;newState.hasPreviousPage=paginationHelpers.hasPreviousPage(newState.page);newState.hasNextPage=paginationHelpers.hasNextPage(newState.page,newState.limit,newState.total);return newState;}else if(isBodyPagination(paginationConfig)){var _paginationConfig$par35,_paginationConfig$par36,_updatedParams$find5;if(pagination&&!isBodyPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}var _newState=pagination?pagination:{source:'body',type:paginationConfig.type,next:result[paginationConfig.params.nextPath||'next'],previous:result[paginationConfig.params.prevPath||'previous'],hasNextPage:!!result[paginationConfig.params.nextPath||'next'],hasPreviousPage:!!result[paginationConfig.params.prevPath||'previous'],limit:parseInt(((_paginationConfig$par35=paginationConfig.params)===null||_paginationConfig$par35===void 0?void 0:(_paginationConfig$par36=_paginationConfig$par35.limit)===null||_paginationConfig$par36===void 0?void 0:_paginationConfig$par36.value)||'10'),total:result[paginationConfig.params.countPath||'count']};if(result){_newState.next=result[paginationConfig.params.nextPath||'next'];_newState.previous=result[paginationConfig.params.prevPath||'previous'];_newState.hasNextPage=!!result[paginationConfig.params.nextPath||'next'];_newState.hasPreviousPage=!!result[paginationConfig.params.prevPath||'previous'];_newState.total=result[paginationConfig.params.countPath||'count'];}_newState.limit=parseInt((_updatedParams$find5=updatedParams.find(function(param){var _paginationConfig$par37,_paginationConfig$par38;return param.name===(paginationConfig===null||paginationConfig===void 0?void 0:(_paginationConfig$par37=paginationConfig.params)===null||_paginationConfig$par37===void 0?void 0:(_paginationConfig$par38=_paginationConfig$par37.limit)===null||_paginationConfig$par38===void 0?void 0:_paginationConfig$par38.name);}))===null||_updatedParams$find5===void 0?void 0:_updatedParams$find5.value)||_newState.limit;return _newState;}else{throw new Error('unrecognized pagination source');}}function renderItemsUI(){var _getAllConfig$display;if(loading){return React.createElement(Loader,null);}var fields=(getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.fields)||(getAllConfig===null||getAllConfig===void 0?void 0:(_getAllConfig$display=getAllConfig.display)===null||_getAllConfig$display===void 0?void 0:_getAllConfig$display.fields)||[];var fieldsToFilter=fields.filter(function(field){return field.filterable;}).map(function(field){return field.name;});var filteredItems=items;if(filter&&fieldsToFilter.length){filteredItems=items.filter(function(item){var passFilter=false;fieldsToFilter.forEach(function(fieldName){var value=item[fieldName];if(typeof value==='string'&&value.toLowerCase().indexOf(filter)>=0){passFilter=true;}});return passFilter;});}if(!filteredItems.length){return React.createElement(\"div\",{className:\"app-error\"},\"Nothing to see here. Result is empty.\");}var getNextPage=paginationConfig?function(){if(isQueryPagination(paginationConfig)){if(pagination&&!isQueryPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}if((pagination===null||pagination===void 0?void 0:pagination.page)&&queryParams.length>0){var newPage=(pagination===null||pagination===void 0?void 0:pagination.page)+1;var updatedParams=queryParams.map(function(param){var _paginationConfig$par39,_paginationConfig$par40;if(param.name===((_paginationConfig$par39=paginationConfig.params)===null||_paginationConfig$par39===void 0?void 0:(_paginationConfig$par40=_paginationConfig$par39.page)===null||_paginationConfig$par40===void 0?void 0:_paginationConfig$par40.name)){return _objectSpread({},param,{value:newPage});}return param;});submitQueryParams(updatedParams);}}else if(isBodyPagination(paginationConfig)){if(pagination&&!isBodyPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}if(!getAllConfig||!(pagination===null||pagination===void 0?void 0:pagination.next)){return;}var requestHeaders=getAllConfig.requestHeaders,actualMethod=getAllConfig.actualMethod,dataPath=getAllConfig.dataPath,sortBy=getAllConfig.sortBy,dataTransform=getAllConfig.dataTransform;fetchPageData({actualMethod:actualMethod,url:pagination.next,requestHeaders:requestHeaders,dataPath:dataPath,dataTransform:dataTransform,sortBy:sortBy});}else{throw new Error('unrecognized pagination source');}}:null;var getPreviousPage=paginationConfig?function(){if(isQueryPagination(paginationConfig)){if(pagination&&!isQueryPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}if((pagination===null||pagination===void 0?void 0:pagination.page)&&pagination.page>1&&queryParams.length>0){var newPage=(pagination===null||pagination===void 0?void 0:pagination.page)-1;var updatedParams=queryParams.map(function(param){var _paginationConfig$par41,_paginationConfig$par42;if(param.name===((_paginationConfig$par41=paginationConfig.params)===null||_paginationConfig$par41===void 0?void 0:(_paginationConfig$par42=_paginationConfig$par41.page)===null||_paginationConfig$par42===void 0?void 0:_paginationConfig$par42.name)){return _objectSpread({},param,{value:newPage});}return param;});submitQueryParams(updatedParams);}}else if(isBodyPagination(paginationConfig)){if(pagination&&!isBodyPaginationState(pagination)){throw new Error('unexpected pagination source '+pagination.source);}if(!getAllConfig||!(pagination===null||pagination===void 0?void 0:pagination.previous)){return;}var requestHeaders=getAllConfig.requestHeaders,actualMethod=getAllConfig.actualMethod,dataPath=getAllConfig.dataPath,sortBy=getAllConfig.sortBy,dataTransform=getAllConfig.dataTransform;fetchPageData({actualMethod:actualMethod,url:pagination.previous,requestHeaders:requestHeaders,dataPath:dataPath,dataTransform:dataTransform,sortBy:sortBy});}else{throw new Error('unrecognized pagination source');}}:null;var callbacks={delete:deleteConfig?deleteItem:null,put:putConfig?openEditPopup:null,action:customActions.length?openCustomActionPopup:function(){},getNextPage:getNextPage,getPreviousPage:getPreviousPage};if((getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.display.type)==='cards'){return React.createElement(Cards,{pagination:pagination,callbacks:callbacks,fields:fields,items:filteredItems,customActions:customActions,customLabels:customLabels});}return React.createElement(Table,{pagination:pagination,callbacks:callbacks,fields:fields,items:filteredItems,customActions:customActions,customLabels:customLabels});}function renderPaginationStateLabel(){if(loading||!items.length){return;}if(!pagination||isQueryPaginationState(pagination)){var _customLabels$paginat;var currentCountFrom=(((pagination===null||pagination===void 0?void 0:pagination.page)||1)-1)*((pagination===null||pagination===void 0?void 0:pagination.limit)||10)+1;var currentCountTo=currentCountFrom+items.length-1;var label=\"Showing results \".concat(currentCountFrom,\"-\").concat(currentCountTo,\" out of \").concat(pagination===null||pagination===void 0?void 0:pagination.total,\" items\");if((pagination===null||pagination===void 0?void 0:pagination.type)==='infinite-scroll'){label=\"Showing \".concat(pagination===null||pagination===void 0?void 0:pagination.total,\" items\");}if(customLabels===null||customLabels===void 0?void 0:(_customLabels$paginat=customLabels.pagination)===null||_customLabels$paginat===void 0?void 0:_customLabels$paginat.itemsCount){var _customLabels$paginat2;label=customLabels===null||customLabels===void 0?void 0:(_customLabels$paginat2=customLabels.pagination)===null||_customLabels$paginat2===void 0?void 0:_customLabels$paginat2.itemsCount.replace(':currentCountFrom',currentCountFrom).replace(':currentCountTo',currentCountFrom).replace(':totalCount',pagination===null||pagination===void 0?void 0:pagination.total);}return React.createElement(\"p\",{className:\"center pagination-state\"},label);}if(isBodyPaginationState(pagination)){var _customLabels$paginat3;// TODO: extract start end end in a meaningful manner from the API\n// this is not something that id based pagination APIs support generally\nvar _label=\"Total Results: \".concat(pagination===null||pagination===void 0?void 0:pagination.total);if((pagination===null||pagination===void 0?void 0:pagination.type)==='infinite-scroll'){_label=\"Showing \".concat(pagination===null||pagination===void 0?void 0:pagination.total,\" items\");}if(customLabels===null||customLabels===void 0?void 0:(_customLabels$paginat3=customLabels.pagination)===null||_customLabels$paginat3===void 0?void 0:_customLabels$paginat3.itemsCount){var _customLabels$paginat4;_label=customLabels===null||customLabels===void 0?void 0:(_customLabels$paginat4=customLabels.pagination)===null||_customLabels$paginat4===void 0?void 0:_customLabels$paginat4.itemsCount.replace(':totalCount',pagination===null||pagination===void 0?void 0:pagination.total);}return React.createElement(\"p\",{className:\"center pagination-state\"},_label);}}function renderPageContent(){var _getAllConfig$display2;var fields=(getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.fields)||(getAllConfig===null||getAllConfig===void 0?void 0:(_getAllConfig$display2=getAllConfig.display)===null||_getAllConfig$display2===void 0?void 0:_getAllConfig$display2.fields)||[];var fieldsToFilter=fields.filter(function(field){return field.filterable;}).map(function(field){return field.name;});return React.createElement(React.Fragment,null,React.createElement(QueryParams,{initialParams:queryParams,paginationConfig:paginationConfig,submitCallback:submitQueryParams}),fieldsToFilter.length>0&&React.createElement(FilterField,{onChange:setFilter}),(pagination===null||pagination===void 0?void 0:pagination.total)&&renderPaginationStateLabel(),error?React.createElement(\"div\",{className:\"app-error\"},error):renderItemsUI());}useEffect(function(){var _context$config,_context$config$pages;var nextActivePage=(context===null||context===void 0?void 0:(_context$config=context.config)===null||_context$config===void 0?void 0:(_context$config$pages=_context$config.pages)===null||_context$config$pages===void 0?void 0:_context$config$pages.filter(function(p,pIdx){return p.id===page||pIdx+1===parseInt(page||'');})[0])||null;context.setActivePage(nextActivePage);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[page]);useEffect(function(){var _buildInitQueryParams2=buildInitQueryParamsAndPaginationState((getAllConfig===null||getAllConfig===void 0?void 0:getAllConfig.queryParams)||[],paginationConfig),initQueryParams=_buildInitQueryParams2.initQueryParams,initialPagination=_buildInitQueryParams2.initialPagination;setItems([]);setQueryParams(extractQueryParams(initQueryParams));setPagination(initialPagination);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[activePage]);useEffect(function(){// Load data when query params \ngetAllRequest();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[queryParams]);return React.createElement(\"div\",{className:\"app-page\"},React.createElement(\"header\",{className:\"app-page-header\"},React.createElement(\"hgroup\",null,React.createElement(\"h2\",null,activePage===null||activePage===void 0?void 0:activePage.name),(activePage===null||activePage===void 0?void 0:activePage.description)&&React.createElement(\"h4\",null,activePage===null||activePage===void 0?void 0:activePage.description)),postConfig&&React.createElement(Button,{className:\"add-item\",color:\"green\",onClick:function onClick(){return setOpenedPopup({type:'add',title:addItemFormTitle,config:postConfig,submitCallback:addItem});}},addItemLabel)),React.createElement(\"main\",{className:\"app-page-content\"},renderPageContent()),openedPopup&&React.createElement(FormPopup,{title:openedPopup.title,closeCallback:closeFormPopup,submitCallback:openedPopup.submitCallback,fields:((_openedPopup$config=openedPopup.config)===null||_openedPopup$config===void 0?void 0:_openedPopup$config.fields)||[],rawData:openedPopup.rawData,getSingleConfig:openedPopup.getSingleConfig,methodConfig:openedPopup.config}));};export var Page=withAppContext(PageComp);","map":{"version":3,"sources":["/Users/claire/Desktop/covid-trend/RESTool2/src/components/page/page.comp.tsx"],"names":["React","useEffect","useState","useParams","useHistory","QueryString","toast","orderBy","find","remove","withAppContext","Loader","dataHelpers","paginationHelpers","Table","Cards","QueryParams","Button","FormPopup","FilterField","isQueryPaginationState","isBodyPaginationState","isQueryPagination","isBodyPagination","buildInitQueryParamsAndPaginationState","initQueryParams","paginationConfig","initialPagination","undefined","source","type","page","parseInt","params","value","limit","descending","hasPreviousPage","hasNextPage","sortBy","name","push","label","next","previous","Error","PageComp","context","location","activePage","error","setError","httpService","config","pageHeaders","requestHeaders","pageMethods","methods","customActions","getAllConfig","getAll","pagination","infiniteScroll","getSingleConfig","getSingle","postConfig","post","putConfig","put","deleteConfig","delete","customLabels","addItemLabel","buttons","addItem","addItemFormTitle","formTitles","editItemFormTitle","editItem","queryParams","loading","setLoading","openedPopup","setOpenedPopup","setQueryParams","setPagination","items","setItems","filter","setFilter","closeFormPopup","refreshData","updatedParams","param","includes","getAllRequest","openEditPopup","rawData","title","submitCallback","body","containFiles","updateItem","openCustomActionPopup","action","performAction","url","actualMethod","fetch","method","origUrl","JSON","stringify","headers","responseType","extractQueryParams","parsedParams","parse","search","finalQueryParams","map","queryParam","decodeURIComponent","getUpdatedPaginationState","fetchPageData","Object","assign","result","extractedData","extractDataByDataPath","dataPath","Array","isArray","dataTransform","orderedItems","total","fields","newPaginationState","message","deleteItem","item","approved","window","confirm","success","submitQueryParams","reset","paramsToUrl","queryState","idx","encodeURIComponent","join","newState","nextPath","prevPath","countPath","renderItemsUI","display","fieldsToFilter","field","filterable","filteredItems","length","passFilter","forEach","fieldName","toLowerCase","indexOf","getNextPage","newPage","getPreviousPage","callbacks","renderPaginationStateLabel","currentCountFrom","currentCountTo","itemsCount","replace","renderPageContent","nextActivePage","pages","p","pIdx","id","setActivePage","description","Page"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport * as QueryString from 'query-string';\nimport { toast } from 'react-toastify';\nimport { orderBy } from 'natural-orderby';\nimport { find, remove } from 'lodash';\n\nimport { IAppContext } from '../app.context';\nimport { IConfigPage, IConfigMethods, IConfigGetAllMethod, IConfigPostMethod, IConfigPutMethod, IConfigDeleteMethod, IConfigInputField, IConfigCustomAction, IConfigGetSingleMethod, ICustomLabels, IConfigPagination } from '../../common/models/config.model';\nimport { IPaginationState, IQueryPaginationState, IBodyPaginationState } from '../../common/models/states.model';\nimport { withAppContext } from '../withContext/withContext.comp';\nimport { Loader } from '../loader/loader.comp';\nimport { dataHelpers } from '../../helpers/data.helpers';\nimport { paginationHelpers } from '../../helpers/pagination.helpers';\nimport { Table } from '../table/table.comp';\nimport { Cards } from '../cards/cards.comp';\nimport { QueryParams } from '../queryParams/queryParams.comp';\nimport { Button } from '../button/button.comp';\nimport { FormPopup } from '../formPopup/formPopup.comp';\nimport { FilterField } from '../filterField/filterField.comp';\nimport { isQueryPaginationState, isBodyPaginationState } from '../../common/models/states.types.helper';\nimport { isQueryPagination, isBodyPagination } from '../../common/models/config.types.helper';\n\nimport './page.scss';\n\ninterface IProps {\n  context: IAppContext\n}\n\ninterface IPopupProps {\n  type: 'add' | 'update' | 'action'\n  title: string\n  config: IConfigPostMethod | IConfigPutMethod\n  submitCallback: (body: any, containFiles: boolean) => void\n  getSingleConfig?: IConfigGetSingleMethod\n  rawData?: {}\n}\n\nconst buildInitQueryParamsAndPaginationState = (\n  initQueryParams: IConfigInputField[],\n  paginationConfig?: IConfigPagination,\n): {\n  initQueryParams: IConfigInputField[],\n  initialPagination?: IPaginationState,\n} => {\n    let initialPagination: IPaginationState | undefined = undefined;\n\n    if (paginationConfig) {\n      if(isQueryPagination(paginationConfig)) {\n        initialPagination = {\n          source: paginationConfig.source,\n          type: paginationConfig.type,\n          page: parseInt(paginationConfig.params?.page?.value || '1'),\n          limit: parseInt(paginationConfig.params?.limit?.value || '10'),\n          descending: paginationConfig.params?.descending?.value === 'true' || false,\n          hasPreviousPage: false,\n          hasNextPage: false,\n          sortBy: paginationConfig.params?.sortBy?.value,\n        };\n\n        if (!find(initQueryParams, { name: 'page' })) {\n          initQueryParams.push({\n            name: paginationConfig?.params?.page?.name,\n            label: paginationConfig?.params?.page?.label || 'Page',\n            value: initialPagination?.page\n          });\n        }\n\n        if (paginationConfig?.params?.limit && !find(initQueryParams, { name: 'limit' })) {\n          initQueryParams.push({\n            name: paginationConfig.params.limit.name,\n            label: paginationConfig.params.limit.label || 'Limit',\n            value: initialPagination?.limit\n          });\n        }\n\n        if (paginationConfig?.params?.descending && !find(initQueryParams, { name: 'descending' })) {\n          initQueryParams.push({\n            name: paginationConfig.params.descending.name,\n            label: paginationConfig.params.descending.label || 'Descending',\n            value: initialPagination?.descending\n          });\n        }\n\n        if (paginationConfig?.params?.sortBy && !find(initQueryParams, { name: 'sortBy' })) {\n          initQueryParams.push({\n            name: paginationConfig.params.sortBy.name,\n            label: 'Sort by',\n            value: initialPagination?.sortBy\n          });\n        }\n      } else if(isBodyPagination(paginationConfig)) {\n        initialPagination = {\n          source: 'body',\n          type: paginationConfig.type,\n          hasNextPage: false,\n          hasPreviousPage: false,\n          next: null,\n          previous: null,\n          limit: parseInt(paginationConfig.params?.limit?.value || '10')\n        }\n\n        if (paginationConfig?.params?.limit && !find(initQueryParams, { name: 'limit' })) {\n          initQueryParams.push({\n            name: paginationConfig.params.limit.name,\n            label: paginationConfig.params.limit.label || 'Limit',\n            value: initialPagination?.limit\n          });\n        }\n\n      } else {\n        throw new Error('unrecognized pagination');\n      }\n    }\n\n    return {\n      initQueryParams,\n      initialPagination\n    };\n};\n\nconst PageComp = ({ context }: IProps) => {\n  const { page } = useParams();\n  const { push, location } = useHistory();\n  const { activePage, error, setError, httpService, config } = context;\n  const pageHeaders: any = activePage?.requestHeaders || {};\n  const pageMethods: IConfigMethods | undefined = activePage?.methods;\n  const customActions: IConfigCustomAction[] = activePage?.customActions || [];\n  const getAllConfig: IConfigGetAllMethod | undefined = pageMethods?.getAll;\n  const paginationConfig = getAllConfig?.pagination;\n  const infiniteScroll = paginationConfig?.type === 'infinite-scroll';\n  const getSingleConfig: IConfigGetSingleMethod | undefined = pageMethods?.getSingle;\n  const postConfig: IConfigPostMethod | undefined = pageMethods?.post;\n  const putConfig: IConfigPutMethod | undefined = pageMethods?.put;\n  const deleteConfig: IConfigDeleteMethod | undefined = pageMethods?.delete;\n  const customLabels: ICustomLabels | undefined = { ...config?.customLabels, ...activePage?.customLabels };\n  const addItemLabel = customLabels?.buttons?.addItem || '+ Add Item';\n  const addItemFormTitle = customLabels?.formTitles?.addItem || 'Add Item';\n  const editItemFormTitle = customLabels?.formTitles?.editItem || 'Update Item';\n  const { initQueryParams, initialPagination } = buildInitQueryParamsAndPaginationState(getAllConfig?.queryParams || [], paginationConfig);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [openedPopup, setOpenedPopup] = useState<null | IPopupProps>(null);\n  const [queryParams, setQueryParams] = useState<IConfigInputField[]>(initQueryParams);\n  const [pagination, setPagination] = useState<IPaginationState | undefined>(initialPagination);\n  const [items, setItems] = useState<any[]>([]);\n  const [filter, setFilter] = useState<string>('');\n\n  function closeFormPopup(refreshData: boolean = false) {\n    setOpenedPopup(null);\n\n    if (refreshData === true) {\n      if (pagination?.type === 'infinite-scroll') {\n        setItems([]);\n        const updatedParams = [...queryParams];\n        remove(updatedParams, param => ['page', 'limit'].includes(param.name));\n        setQueryParams(buildInitQueryParamsAndPaginationState(updatedParams, paginationConfig).initQueryParams);\n      } else {\n        getAllRequest();\n      }\n    }\n  }\n\n  async function openEditPopup(rawData: any) {\n    const params: IPopupProps = {\n      rawData,\n      type: 'update',\n      title: editItemFormTitle,\n      config: putConfig as IConfigPutMethod,\n      getSingleConfig,\n      submitCallback: async (body: any, containFiles: boolean) => {\n        return await updateItem(body, rawData, containFiles);\n      }\n    };\n\n    setOpenedPopup(params);\n  }\n\n  function openCustomActionPopup(rawData: any, action: IConfigCustomAction) {\n    const params: IPopupProps = {\n      rawData,\n      type: 'action',\n      title: action.name || 'Custom Action',\n      config: action as IConfigCustomAction,\n      submitCallback: async (body: any, containFiles: boolean) => {\n        return await performAction(body, rawData, action, containFiles);\n      }\n    };\n\n    setOpenedPopup(params);\n  }\n\n  async function performAction(body: any, rawData: any, action: IConfigCustomAction, containFiles: boolean) {\n    const { url, requestHeaders, actualMethod } = action;\n\n    return await httpService.fetch({\n      method: actualMethod || 'put',\n      origUrl: url,\n      rawData,\n      body: containFiles ? body : JSON.stringify(body),\n      headers: {\n        ...pageHeaders,\n        ...(requestHeaders || {}),\n        ...(containFiles ? {} : { 'content-type': 'application/json' })\n      },\n      responseType: 'boolean'\n    });\n  }\n\n  function extractQueryParams(params: IConfigInputField[]): IConfigInputField[] {\n    if(!paginationConfig || isQueryPagination(paginationConfig)) {\n      const parsedParams = QueryString.parse(location.search);\n      const finalQueryParams = params.map((queryParam) => {\n        if (typeof parsedParams[queryParam.name] !== 'undefined') {\n          queryParam.value = queryParam.type === 'boolean' ? (parsedParams[queryParam.name] === 'true') : decodeURIComponent(parsedParams[queryParam.name] as any);\n        } else {\n          queryParam.value = queryParam.value || '';\n        }\n        return queryParam;\n      });\n\n      setPagination(getUpdatedPaginationState(finalQueryParams, null))\n\n      return finalQueryParams;\n    } else {\n      return params;\n    }\n  }\n\n  async function fetchPageData(params: {\n    actualMethod: 'get' | 'put' | 'post' | 'patch' | 'delete', \n    url: string,\n    requestHeaders?: any,\n    dataPath: string,\n    dataTransform: any,\n    sortBy: any\n  }) {\n    const result = await httpService.fetch({\n      method: params.actualMethod || 'get',\n      origUrl: params.url,\n      queryParams,\n      headers: Object.assign({}, pageHeaders, params.requestHeaders || {})\n    });\n    let extractedData = dataHelpers.extractDataByDataPath(result, params.dataPath);\n\n    if (!extractedData) {\n      throw new Error('Could not extract data from response.');\n    }\n\n    if (!Array.isArray(extractedData)) {\n      throw new Error('Extracted data is invalid.');\n    }\n\n    if (typeof params.dataTransform === 'function') {\n      extractedData = await params.dataTransform(extractedData);\n    }\n\n    const orderedItems = orderBy(extractedData, typeof params.sortBy === 'string' ? [params.sortBy] : (params.sortBy || []));\n\n    if (paginationConfig) {\n      const total = paginationConfig.fields?.total ? dataHelpers.extractDataByDataPath(result, paginationConfig.fields.total.dataPath) : undefined;\n      const newPaginationState = getUpdatedPaginationState(queryParams, result, total);\n      if (newPaginationState) {\n        setPagination(newPaginationState);\n      }\n    }\n\n    if (infiniteScroll) {\n      setItems([...items, ...orderedItems]);\n    } else {\n      setItems(orderedItems);\n    }\n  }\n\n  async function getAllRequest() {\n    if (infiniteScroll) {\n      if(pagination) {\n        if(isQueryPaginationState(pagination)) {\n          if(pagination?.page !== 1) {\n            setLoading(false);\n          }\n        } else if( isBodyPaginationState(pagination)) {\n          if(pagination.previous) {\n            setLoading(false);\n          }\n        } else {\n          throw new Error('unrecognized pagination source');\n        }\n      }\n    } else {\n      setLoading(true);\n    }\n\n    setError(null);\n\n    try {\n      if (!getAllConfig) {\n        throw new Error('Get all method is not defined.');\n      }\n\n      if (paginationConfig && !pagination) {\n        throw new Error('Pagination not initialized.');\n      }\n\n      const { url, requestHeaders, actualMethod, dataPath, sortBy, dataTransform } = getAllConfig;\n      fetchPageData(\n        {\n          actualMethod: actualMethod,\n          url: url,\n          requestHeaders: requestHeaders,\n          dataPath: dataPath,\n          dataTransform: dataTransform,\n          sortBy: sortBy\n        }\n      )\n\n    } catch (e) {\n      setError(e.message);\n    }\n\n    setLoading(false);\n  }\n\n  async function addItem(body: any, containFiles?: boolean) {\n    if (!postConfig) {\n      throw new Error('Post method is not defined.');\n    }\n\n    const { url, requestHeaders, actualMethod } = postConfig;\n\n    return await httpService.fetch({\n      method: actualMethod || 'post',\n      origUrl: url,\n      body: containFiles ? body : JSON.stringify(body),\n      headers: {\n        ...pageHeaders,\n        ...(requestHeaders || {}),\n        ...(containFiles ? {} : { 'content-type': 'application/json' })\n      },\n      responseType: 'boolean'\n    });\n  }\n\n  async function updateItem(body: any, rawData: any, containFiles?: boolean) {\n    if (!putConfig) {\n      throw new Error('Put method is not defined.');\n    }\n\n    const { url, requestHeaders, actualMethod } = putConfig;\n\n    return await httpService.fetch({\n      method: actualMethod || 'put',\n      origUrl: url,\n      rawData,\n      body: containFiles ? body : JSON.stringify(body),\n      headers: {\n        ...pageHeaders,\n        ...(requestHeaders || {}),\n        ...(containFiles ? {} : { 'content-type': 'application/json' })\n      },\n      responseType: 'boolean'\n    });\n  }\n\n  async function deleteItem(item: any) {\n    const approved: boolean = window.confirm('Are you sure you want to delete this item?');\n\n    if (!approved) {\n      return;\n    }\n\n    try {\n      if (!deleteConfig) {\n        throw new Error('Delete method is not defined.');\n      }\n\n      const { url, requestHeaders, actualMethod } = deleteConfig;\n      const success = await httpService.fetch({\n        method: actualMethod || 'delete',\n        origUrl: url,\n        rawData: item,\n        headers: Object.assign({}, pageHeaders, requestHeaders || {}),\n        responseType: 'boolean'\n      });\n\n      if (success) {\n        if (pagination?.type === 'infinite-scroll') {\n          setItems([]);\n          const updatedParams = [...queryParams];\n          remove(updatedParams, param => ['page', 'limit'].includes(param.name));\n          setQueryParams(buildInitQueryParamsAndPaginationState(updatedParams, paginationConfig).initQueryParams);\n        } else {\n          getAllRequest();\n        }\n      }\n    } catch (e) {\n      toast.error(e.message);\n    }\n  }\n\n  function submitQueryParams(updatedParams: IConfigInputField[], reset?: boolean) {\n    if (loading) {\n      return;\n    }\n    \n    if (reset) {\n      setItems([]);\n      remove(updatedParams, param => ['page', 'limit'].includes(param.name));\n      updatedParams = buildInitQueryParamsAndPaginationState(updatedParams, paginationConfig).initQueryParams;\n    }\n\n    setQueryParams(updatedParams);\n    setPagination(getUpdatedPaginationState(updatedParams, null));\n\n    let paramsToUrl = [...updatedParams];\n\n    if (paginationConfig?.type === 'infinite-scroll') {\n      paramsToUrl = paramsToUrl.filter(param => !['page', 'limit'].includes(param.name));\n    }\n\n    // Building query string\n    const queryState: string = paramsToUrl.map((queryParam, idx) => {\n      let value = queryParam.value;\n\n      if (queryParam.type === 'select' && value === '-- Select --') {\n          // default value means nothing was selected and thus we explicitly\n          // empty out the value in this case; otherwise the string '-- Select --'\n          // is used as the value for the given queryParams\n          value = '';\n      }\n\n      return `${idx === 0 ? '?' : ''}${queryParam.name}=${encodeURIComponent(value || '')}`;\n    }).join('&');\n\n    // Pushing query state to url\n    if (page && queryState) {\n      push(queryState);\n    }\n  }\n\n  function getUpdatedPaginationState(updatedParams: IConfigInputField[], result: any, total?: number): IPaginationState | undefined {\n    if (!paginationConfig) {\n      return;\n    }\n\n    if(isQueryPagination(paginationConfig)) {\n      if(pagination && !isQueryPaginationState(pagination)) {\n        throw new Error('unexpected pagination source ' + pagination.source)\n      }\n      const newState: IQueryPaginationState = pagination ? pagination : {\n        source: 'query',\n        type: paginationConfig.type,\n        page: parseInt(paginationConfig.params?.page?.value || '1'),\n        limit: parseInt(paginationConfig.params?.limit?.value || '10'),\n        descending: paginationConfig.params?.descending?.value === 'true' || false,\n        hasPreviousPage: false,\n        hasNextPage: false,\n        sortBy: paginationConfig.params?.sortBy?.value,\n      };\n\n      newState.total = total || pagination?.total;\n      newState.page = parseInt(updatedParams.find(param => param.name === paginationConfig?.params?.page?.name)?.value) || newState.page;\n      newState.limit = parseInt(updatedParams.find(param => param.name === paginationConfig?.params?.limit?.name)?.value) || newState.limit;\n      newState.descending = updatedParams.find(param => param.name === paginationConfig?.params?.descending?.name)?.value === 'true' || newState.descending;\n      newState.sortBy = updatedParams.find(param => param.name === paginationConfig?.params?.sortBy?.name)?.value || newState.sortBy;\n      newState.hasPreviousPage = paginationHelpers.hasPreviousPage(newState.page);\n      newState.hasNextPage = paginationHelpers.hasNextPage(newState.page, newState.limit, newState.total);\n      return newState;\n    } else if(isBodyPagination(paginationConfig)) {\n      if(pagination && !isBodyPaginationState(pagination)) {\n        throw new Error('unexpected pagination source ' + pagination.source)\n      }\n      const newState: IBodyPaginationState = pagination ? pagination : {\n        source: 'body',\n        type: paginationConfig.type,\n        next: result[paginationConfig.params.nextPath || 'next'],\n        previous: result[paginationConfig.params.prevPath || 'previous'],\n        hasNextPage: !!result[paginationConfig.params.nextPath || 'next'],\n        hasPreviousPage: !!result[paginationConfig.params.prevPath || 'previous'],\n        limit: parseInt(paginationConfig.params?.limit?.value || '10'),\n        total: result[paginationConfig.params.countPath || 'count']\n      };\n      if(result) {\n        newState.next = result[paginationConfig.params.nextPath || 'next'];\n        newState.previous = result[paginationConfig.params.prevPath || 'previous'];\n        newState.hasNextPage = !!result[paginationConfig.params.nextPath || 'next'];\n        newState.hasPreviousPage = !!result[paginationConfig.params.prevPath || 'previous'];\n        newState.total = result[paginationConfig.params.countPath || 'count'];\n      }\n      newState.limit = parseInt(updatedParams.find(param => param.name === paginationConfig?.params?.limit?.name)?.value) || newState.limit;\n      return newState;\n    } else {\n      throw new Error('unrecognized pagination source');\n    }\n  }\n\n  function renderItemsUI() {\n    if (loading) {\n      return <Loader />;\n    }\n\n    const fields = getAllConfig?.fields || getAllConfig?.display?.fields || [];\n    const fieldsToFilter = fields.filter((field) => (field.filterable)).map((field) => field.name);\n    let filteredItems = items;\n\n    if (filter && fieldsToFilter.length) {\n      filteredItems = items.filter((item) => {\n        let passFilter = false;\n        fieldsToFilter.forEach((fieldName) => {\n          const value = item[fieldName];\n          if (typeof value === 'string' && value.toLowerCase().indexOf(filter) >= 0) {\n            passFilter = true;\n          }\n        })\n        return passFilter;\n      });\n    }\n\n    if (!filteredItems.length) {\n      return <div className=\"app-error\">Nothing to see here. Result is empty.</div>;\n    }\n\n    const getNextPage = paginationConfig ? () => {\n      if(isQueryPagination(paginationConfig)) {\n        if(pagination && !isQueryPaginationState(pagination)) {\n          throw new Error('unexpected pagination source ' + pagination.source)\n        }\n        if (pagination?.page && queryParams.length > 0) {\n          const newPage = pagination?.page + 1;\n          const updatedParams = queryParams.map((param) => {\n            if (param.name === paginationConfig.params?.page?.name) {\n              return {\n                ...param,\n                value: newPage\n              }\n            }\n            return param;\n          });\n          submitQueryParams(updatedParams);\n        }\n      } else if(isBodyPagination(paginationConfig)) {\n        if(pagination && !isBodyPaginationState(pagination)) {\n          throw new Error('unexpected pagination source ' + pagination.source)\n        }\n        if(!getAllConfig || !pagination?.next) {\n          return;\n        }\n        const { requestHeaders, actualMethod, dataPath, sortBy, dataTransform } = getAllConfig;\n        fetchPageData(\n          {\n            actualMethod: actualMethod,\n            url: pagination.next,\n            requestHeaders: requestHeaders,\n            dataPath: dataPath,\n            dataTransform: dataTransform,\n            sortBy: sortBy\n          }\n        )\n      } else {\n        throw new Error('unrecognized pagination source');\n      }\n    } : null;\n\n    const getPreviousPage = paginationConfig ? () => {\n      if(isQueryPagination(paginationConfig)) {\n        if(pagination && !isQueryPaginationState(pagination)) {\n          throw new Error('unexpected pagination source ' + pagination.source)\n        }\n        if (pagination?.page && pagination.page > 1 && queryParams.length > 0) {\n          const newPage = pagination?.page - 1;\n          const updatedParams = queryParams.map((param) => {\n            if (param.name === paginationConfig.params?.page?.name) {\n              return {\n                ...param,\n                value: newPage\n              }\n            }\n            return param;\n          });\n          submitQueryParams(updatedParams);\n        }\n      } else if(isBodyPagination(paginationConfig)) {\n        if(pagination && !isBodyPaginationState(pagination)) {\n          throw new Error('unexpected pagination source ' + pagination.source)\n        }\n        if(!getAllConfig || !pagination?.previous) {\n          return;\n        }\n        const { requestHeaders, actualMethod, dataPath, sortBy, dataTransform } = getAllConfig;\n        fetchPageData(\n          {\n            actualMethod: actualMethod,\n            url: pagination.previous,\n            requestHeaders: requestHeaders,\n            dataPath: dataPath,\n            dataTransform: dataTransform,\n            sortBy: sortBy\n          }\n        )\n      } else {\n        throw new Error('unrecognized pagination source');\n      }\n    } : null;\n\n    const callbacks = {\n      delete: deleteConfig ? deleteItem : null,\n      put: putConfig ? openEditPopup : null,\n      action: customActions.length ? openCustomActionPopup : () => { },\n      getNextPage,\n      getPreviousPage,\n    };\n\n    if (getAllConfig?.display.type === 'cards') {\n      return (\n        <Cards\n          pagination={pagination}\n          callbacks={callbacks}\n          fields={fields}\n          items={filteredItems}\n          customActions={customActions}\n          customLabels={customLabels}\n        />\n      );\n    }\n\n    return (\n      <Table\n        pagination={pagination}\n        callbacks={callbacks}\n        fields={fields}\n        items={filteredItems}\n        customActions={customActions}\n        customLabels={customLabels}\n      />\n    );\n  }\n\n  function renderPaginationStateLabel() {\n    if (loading || !items.length) {\n      return;\n    }\n    \n    if(!pagination || isQueryPaginationState(pagination)) {\n      const currentCountFrom = (((pagination?.page || 1) - 1) * (pagination?.limit || 10)) + 1;\n      const currentCountTo = currentCountFrom + items.length - 1;\n      let label: string = `Showing results ${currentCountFrom}-${currentCountTo} out of ${pagination?.total} items`;\n\n      if (pagination?.type === 'infinite-scroll') {\n        label = `Showing ${pagination?.total} items`;\n      }\n\n      if (customLabels?.pagination?.itemsCount) {\n        label = customLabels?.pagination?.itemsCount\n                .replace(':currentCountFrom', currentCountFrom as any)\n                .replace(':currentCountTo', currentCountFrom as any)\n                .replace(':totalCount', pagination?.total as any);\n      }\n\n      return (\n        <p className=\"center pagination-state\">\n          {label}\n        </p>\n      );\n    }\n    if(isBodyPaginationState(pagination)) {\n      // TODO: extract start end end in a meaningful manner from the API\n      // this is not something that id based pagination APIs support generally\n      let label: string = `Total Results: ${pagination?.total}`;\n      if (pagination?.type === 'infinite-scroll') {\n        label = `Showing ${pagination?.total} items`;\n      }\n\n      if (customLabels?.pagination?.itemsCount) {\n        label = customLabels?.pagination?.itemsCount\n                .replace(':totalCount', pagination?.total as any);\n      }\n\n      return (\n        <p className=\"center pagination-state\">\n          {label}\n        </p>\n      );\n    }\n  }\n\n  function renderPageContent() {\n    const fields = getAllConfig?.fields || getAllConfig?.display?.fields || [];\n    const fieldsToFilter = fields.filter((field) => (field.filterable)).map((field) => field.name);\n\n    return (\n      <React.Fragment>\n        <QueryParams\n          initialParams={queryParams}\n          paginationConfig={paginationConfig}\n          submitCallback={submitQueryParams}\n        />\n        {\n          fieldsToFilter.length > 0 &&\n          <FilterField onChange={setFilter} />\n        }\n        {\n          pagination?.total &&\n          renderPaginationStateLabel()\n        }\n        {\n          error ?\n          <div className=\"app-error\">{error}</div> :\n          renderItemsUI()\n        }\n      </React.Fragment>\n    )\n  }\n\n  useEffect(() => {\n    const nextActivePage: IConfigPage | null = context?.config?.pages?.filter((p, pIdx) => p.id === page || (pIdx + 1) === parseInt(page || ''))[0] || null;\n    context.setActivePage(nextActivePage);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [page]);\n\n  useEffect(() => {\n    const { initQueryParams, initialPagination } = buildInitQueryParamsAndPaginationState(getAllConfig?.queryParams || [], paginationConfig);\n\n    setItems([]);\n    setQueryParams(extractQueryParams(initQueryParams));\n    setPagination(initialPagination);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [activePage]);\n\n  useEffect(() => {\n    // Load data when query params \n    getAllRequest();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [queryParams]);\n\n  return (\n    <div className=\"app-page\">\n      <header className=\"app-page-header\">\n        <hgroup>\n          <h2>{activePage?.name}</h2>\n          {\n            activePage?.description &&\n            <h4>{activePage?.description}</h4>\n          }\n        </hgroup>\n        {\n          postConfig &&\n          <Button className=\"add-item\" color=\"green\" onClick={() => setOpenedPopup({ type: 'add', title: addItemFormTitle, config: postConfig, submitCallback: addItem })}>{addItemLabel}</Button>\n        }\n      </header>\n      <main className=\"app-page-content\">\n        {renderPageContent()}\n      </main>\n      {\n        openedPopup &&\n        <FormPopup\n          title={openedPopup.title}\n          closeCallback={closeFormPopup}\n          submitCallback={openedPopup.submitCallback}\n          fields={openedPopup.config?.fields || []}\n          rawData={openedPopup.rawData}\n          getSingleConfig={openedPopup.getSingleConfig}\n          methodConfig={openedPopup.config}\n        />\n      }\n    </div>\n  );\n}\n\nexport const Page = withAppContext(PageComp);\n"]},"metadata":{},"sourceType":"module"}