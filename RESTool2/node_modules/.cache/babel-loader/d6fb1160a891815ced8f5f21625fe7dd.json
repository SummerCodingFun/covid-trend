{"ast":null,"code":"import _regeneratorRuntime from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/claire/Desktop/covid-trend/RESTool2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{HashRouter as Router,Route,Switch,Redirect}from'react-router-dom';import{ToastContainer,toast}from'react-toastify';import ConfigService from'../services/config.service';import{Page}from'../components/page/page.comp';import{Navigation}from'../components/navigation/navigation.comp';import{AppContext}from'./app.context';import HttpService from'../services/http.service';import{CustomStyles}from'./customStyles/customStyles.comp';import'./app.scss';import'react-toastify/dist/ReactToastify.css';var httpService=new HttpService();var defaultAppName='RESTool App';function changeFavicon(src){var link=document.createElement('link');var oldLink=document.getElementById('favicon');link.id='favicon';link.rel='shortcut icon';link.href=src;if(oldLink){document.head.removeChild(oldLink);}document.head.appendChild(link);}function App(){var _config$pages,_config$pages2,_config$pages2$;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),firstLoad=_useState2[0],setFirstLoad=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),config=_useState4[0],setConfig=_useState4[1];var _useState5=useState((config===null||config===void 0?void 0:(_config$pages=config.pages)===null||_config$pages===void 0?void 0:_config$pages[0])||null),_useState6=_slicedToArray(_useState5,2),activePage=_useState6[0],setActivePage=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var appName=(config===null||config===void 0?void 0:config.name)||defaultAppName;function loadConfig(url){var _RESTool,_remoteConfig,_remoteConfig2,windowConfig,remoteConfig;return _regeneratorRuntime.async(function loadConfig$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;windowConfig=(_RESTool=window.RESTool)===null||_RESTool===void 0?void 0:_RESTool.config;if(!(!url&&windowConfig)){_context.next=6;break;}remoteConfig=Object.assign({},windowConfig,{});_context.next=16;break;case 6:if(!url){_context.next=12;break;}_context.next=9;return _regeneratorRuntime.awrap(ConfigService.getRemoteConfig(url));case 9:_context.t0=_context.sent;_context.next=15;break;case 12:_context.next=14;return _regeneratorRuntime.awrap(ConfigService.loadDefaultConfig());case 14:_context.t0=_context.sent;case 15:remoteConfig=_context.t0;case 16:// Setting global config for httpService\nhttpService.baseUrl=remoteConfig.baseUrl||'';httpService.errorMessageDataPath=remoteConfig.errorMessageDataPath||'';httpService.unauthorizedRedirectUrl=remoteConfig.unauthorizedRedirectUrl||'';httpService.requestHeaders=remoteConfig.requestHeaders||{};document.title=remoteConfig.name||defaultAppName;if((_remoteConfig=remoteConfig)===null||_remoteConfig===void 0?void 0:_remoteConfig.favicon){changeFavicon(remoteConfig.favicon);}if(!((_remoteConfig2=remoteConfig)===null||_remoteConfig2===void 0?void 0:_remoteConfig2.remoteUrl)){_context.next=26;break;}_context.next=25;return _regeneratorRuntime.awrap(loadConfig(remoteConfig.remoteUrl));case 25:return _context.abrupt(\"return\",_context.sent);case 26:setConfig(remoteConfig);_context.next=32;break;case 29:_context.prev=29;_context.t1=_context[\"catch\"](0);console.error('Could not load config file',_context.t1);case 32:setFirstLoad(false);case 33:case\"end\":return _context.stop();}}},null,null,[[0,29]]);}function scrollToTop(){var scrollDuration=arguments.length>0&&arguments[0]!==undefined?arguments[0]:250;var cosParameter=window.scrollY/2,scrollCount=0,oldTimestamp=performance.now();function step(newTimestamp){scrollCount+=Math.PI/(scrollDuration/(newTimestamp-oldTimestamp));if(scrollCount>=Math.PI){window.scrollTo(0,0);}if(window.scrollY===0){return;}window.scrollTo(0,Math.round(cosParameter+cosParameter*Math.cos(scrollCount)));oldTimestamp=newTimestamp;window.requestAnimationFrame(step);}window.requestAnimationFrame(step);}useEffect(function(){loadConfig();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){var _ConfigService$valida=ConfigService.validateConfig(config),isValid=_ConfigService$valida.isValid,errorMessage=_ConfigService$valida.errorMessage;if(!isValid){setError(errorMessage);toast.error(errorMessage);return;}},[config]);return React.createElement(\"div\",{className:\"restool-app\"},!config?React.createElement(\"div\",{className:\"app-error\"},firstLoad?'Loading Configuration...':'Could not find config file.'):React.createElement(AppContext.Provider,{value:{config:config,activePage:activePage,setActivePage:setActivePage,error:error,setError:setError,httpService:httpService}},config.customStyles&&React.createElement(CustomStyles,{styles:config.customStyles}),React.createElement(Router,null,React.createElement(\"aside\",null,React.createElement(\"h1\",{title:appName,onClick:function onClick(){return scrollToTop();}},appName),React.createElement(Navigation,null)),config&&React.createElement(Switch,null,React.createElement(Route,{exact:true,path:\"/:page\",component:Page}),React.createElement(Redirect,{path:\"/\",to:\"/\".concat((config===null||config===void 0?void 0:(_config$pages2=config.pages)===null||_config$pages2===void 0?void 0:(_config$pages2$=_config$pages2[0])===null||_config$pages2$===void 0?void 0:_config$pages2$.id)||'1')})),React.createElement(ToastContainer,{position:toast.POSITION.TOP_CENTER,autoClose:4000,draggable:false}))));}export default App;","map":{"version":3,"sources":["/Users/claire/Desktop/covid-trend/RESTool2/src/components/app.tsx"],"names":["React","useEffect","useState","HashRouter","Router","Route","Switch","Redirect","ToastContainer","toast","ConfigService","Page","Navigation","AppContext","HttpService","CustomStyles","httpService","defaultAppName","changeFavicon","src","link","document","createElement","oldLink","getElementById","id","rel","href","head","removeChild","appendChild","App","firstLoad","setFirstLoad","config","setConfig","pages","activePage","setActivePage","error","setError","appName","name","loadConfig","url","windowConfig","window","RESTool","remoteConfig","Object","assign","getRemoteConfig","loadDefaultConfig","baseUrl","errorMessageDataPath","unauthorizedRedirectUrl","requestHeaders","title","favicon","remoteUrl","console","scrollToTop","scrollDuration","cosParameter","scrollY","scrollCount","oldTimestamp","performance","now","step","newTimestamp","Math","PI","scrollTo","round","cos","requestAnimationFrame","validateConfig","isValid","errorMessage","customStyles","POSITION","TOP_CENTER"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { HashRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\nimport { ToastContainer, toast } from 'react-toastify';\nimport ConfigService from '../services/config.service';\nimport { IConfig, IConfigPage } from '../common/models/config.model';\nimport { Page } from '../components/page/page.comp';\nimport { Navigation } from '../components/navigation/navigation.comp';\nimport { AppContext } from './app.context';\nimport HttpService from '../services/http.service';\nimport { CustomStyles } from './customStyles/customStyles.comp';\n\nimport './app.scss';\nimport 'react-toastify/dist/ReactToastify.css';\n\nconst httpService = new HttpService();\nconst defaultAppName: string = 'RESTool App';\n\nfunction changeFavicon(src: string) {\n  const link = document.createElement('link');\n  const oldLink = document.getElementById('favicon');\n  link.id = 'favicon';\n  link.rel = 'shortcut icon';\n  link.href = src;\n  if (oldLink) {\n   document.head.removeChild(oldLink);\n  }\n  document.head.appendChild(link);\n }\n\nfunction App() {\n  const [firstLoad, setFirstLoad] = useState<boolean>(true);\n  const [config, setConfig] = useState<IConfig | null>(null);\n  const [activePage, setActivePage] = useState<IConfigPage | null>(config?.pages?.[0] || null);\n  const [error, setError] = useState<string | null>(null);\n  const appName: string = config?.name || defaultAppName;\n  \n  async function loadConfig(url?: string): Promise<void> {\n    try {\n      const windowConfig = (window as any).RESTool?.config;\n      let remoteConfig: IConfig; \n      // Try to load config from window object first\n      if (!url && windowConfig) {\n        remoteConfig = Object.assign({}, windowConfig, {});\n      } else {\n        remoteConfig = url ? await ConfigService.getRemoteConfig(url) : await ConfigService.loadDefaultConfig();\n      }\n\n      // Setting global config for httpService\n      httpService.baseUrl = remoteConfig.baseUrl || '';\n      httpService.errorMessageDataPath = remoteConfig.errorMessageDataPath || '';\n      httpService.unauthorizedRedirectUrl = remoteConfig.unauthorizedRedirectUrl || '';\n      httpService.requestHeaders = remoteConfig.requestHeaders || {};\n      document.title = remoteConfig.name || defaultAppName;\n\n      if (remoteConfig?.favicon) {\n        changeFavicon(remoteConfig.favicon);\n      }\n\n      if (remoteConfig?.remoteUrl) {\n        return await loadConfig(remoteConfig.remoteUrl);\n      }\n\n      setConfig(remoteConfig);\n    } catch (e) {\n      console.error('Could not load config file', e);\n    }\n\n    setFirstLoad(false);\n  }\n\n  function scrollToTop(scrollDuration: number = 250) {\n    var cosParameter = window.scrollY / 2,\n    scrollCount = 0,\n    oldTimestamp = performance.now();\n\n    function step (newTimestamp: number) {\n      scrollCount += Math.PI / (scrollDuration / (newTimestamp - oldTimestamp));\n\n      if (scrollCount >= Math.PI) {\n        window.scrollTo(0, 0);\n      }\n\n      if (window.scrollY === 0) {\n        return;\n      }\n\n      window.scrollTo(0, Math.round(cosParameter + cosParameter * Math.cos(scrollCount)));\n      oldTimestamp = newTimestamp;\n      window.requestAnimationFrame(step);\n    }\n\n    window.requestAnimationFrame(step);\n  }\n\n  useEffect(() => {\n    loadConfig();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    const { isValid, errorMessage } = ConfigService.validateConfig(config);\n\n    if (!isValid) {\n      setError(errorMessage);\n      toast.error(errorMessage);\n      return;\n    }\n  }, [config]);\n\n  return (\n    <div className=\"restool-app\">\n      {\n        !config ?\n        <div className=\"app-error\">\n          {firstLoad ? 'Loading Configuration...' : 'Could not find config file.'}\n        </div> :\n        <AppContext.Provider value={{ config, activePage, setActivePage, error, setError, httpService }}>\n          {\n            config.customStyles &&\n            <CustomStyles\n              styles={config.customStyles}\n            />\n          }\n          <Router>\n            <aside>\n              <h1 title={appName} onClick={() => scrollToTop()}>{appName}</h1>\n              {\n                <Navigation />\n              }\n            </aside>\n            {\n              config &&\n              <Switch>\n                <Route exact path=\"/:page\" component={Page} />\n                <Redirect path=\"/\" to={`/${config?.pages?.[0]?.id || '1'}`} />\n              </Switch>\n            }\n            <ToastContainer\n              position={toast.POSITION.TOP_CENTER}\n              autoClose={4000}\n              draggable={false}\n            />\n          </Router>\n        </AppContext.Provider>\n      }\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}